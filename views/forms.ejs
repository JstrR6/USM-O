<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> | Military Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .folder {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .folder:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .folder-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1.5rem;
        }
        .folder-opened .folder-grid {
            transform: scale(0.95);
            margin-bottom: 2rem;
        }
        .folder-content {
            background-color: #e5e7eb;
            padding: 1.5rem;
            border-radius: 0.5rem;
            margin-top: -1rem;
            animation: fadeIn 0.2s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
    <script>
        function toggleFolder(folderName) {
            const allContent = document.querySelectorAll('.folder-content');
            allContent.forEach(el => el.classList.add('hidden'));

            const target = document.getElementById('folder-' + folderName);
            if (target) target.classList.remove('hidden');
        }
    </script>
</head>
<body class="bg-gray-100">
    <div class="min-h-screen flex">
        <!-- Sidebar -->
        <div class="bg-gray-800 text-white w-64 py-6 flex flex-col">
            <div class="px-6 py-4">
                <h1 class="text-2xl font-semibold">Military Portal</h1>
            </div>
            <nav class="flex-1 px-4 mt-6">
                <a href="/dashboard" class="flex items-center px-4 py-3 text-gray-300 hover:bg-gray-700 rounded-lg <%= path === '/dashboard' ? 'bg-gray-700' : '' %>">
                    <i class="fas fa-home w-5 h-5 mr-3"></i> Dashboard
                </a>
                <a href="/forms" class="flex items-center px-4 py-3 mt-2 text-gray-300 hover:bg-gray-700 rounded-lg <%= path === '/forms' ? 'bg-gray-700' : '' %>">
                    <i class="fas fa-file-alt w-5 h-5 mr-3"></i> Forms
                </a>
                <a href="/profile" class="flex items-center px-4 py-3 mt-2 text-gray-300 hover:bg-gray-700 rounded-lg <%= path === '/profile' ? 'bg-gray-700' : '' %>">
                    <i class="fas fa-user w-5 h-5 mr-3"></i> Profile
                </a>
                <a href="/members" class="flex items-center px-4 py-3 mt-2 text-gray-300 hover:bg-gray-700 rounded-lg <%= path === '/members' ? 'bg-gray-700' : '' %>">
                    <i class="fas fa-users w-5 h-5 mr-3"></i> Members
                </a>
            </nav>
            <div class="px-6 py-4 border-t border-gray-700">
                <div class="flex items-center">
                    <div class="ml-3">
                        <p class="text-sm font-medium"><%= user.username %></p>
                        <p class="text-xs text-gray-400"><%= user.highestRole %></p>
                    </div>
                </div>
                <a href="/logout" class="mt-4 block px-4 py-2 text-center text-sm text-white bg-red-600 hover:bg-red-700 rounded-lg">Logout</a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-6">
            <h1 class="text-2xl font-bold mb-6">Forms</h1>

            <% const RANKS = [
                "Citizen", "Airman Basic", "Airman", "Airman First Class", "Senior Airman",
                "Staff Sergeant", "Technical Sergeant", "Master Sergeant", "First Sergeant",
                "Senior Master Sergeant", "Senior First Sergeant", "Chief Master Sergeant",
                "Chief First Sergeant", "Command Chief Master Sergeant", "Senior Enlisted Leader",
                "Chief Senior Enlisted Leader", "Chief Master Sergeant of the Air Force",
                "Second Lieutenant", "First Lieutenant", "Captain",
                "Major", "Lieutenant Colonel", "Colonel",
                "Brigadier General", "Major General", "Lieutenant General", "General", "General of the Air Force"
            ]; %>

            <% const folderMap = [
                { name: 'Citizen', ranks: ['Citizen'], icon: 'fa-user', priority: 1 },
                { name: 'Enlisted', ranks: ['Airman Basic', 'Airman', 'Airman First Class', 'Senior Airman'], icon: 'fa-users', priority: 2 },
                { name: 'NCO', ranks: ['Staff Sergeant', 'Technical Sergeant', 'Master Sergeant', 'First Sergeant'], icon: 'fa-user-shield', priority: 3 },
                { name: 'SNCO', ranks: [
                    'Senior Master Sergeant', 'Senior First Sergeant', 'Chief Master Sergeant',
                    'Chief First Sergeant', 'Command Chief Master Sergeant', 'Senior Enlisted Leader',
                    'Chief Senior Enlisted Leader', 'Chief Master Sergeant of the Air Force'
                ], icon: 'fa-user-tie', priority: 4 },
                { name: 'Company Officers', ranks: ['Second Lieutenant', 'First Lieutenant', 'Captain'], icon: 'fa-chess-pawn', priority: 5 },
                { name: 'Field Officers', ranks: ['Major', 'Lieutenant Colonel', 'Colonel'], icon: 'fa-chess-rook', priority: 6 },
                { name: 'Headquarters', ranks: ['Brigadier General', 'Major General', 'Lieutenant General', 'General', 'General of the Air Force'], icon: 'fa-chess-king', priority: 7 },
            ]; %>

            <% const userRank = user.highestRole;
            const userRankIndex = RANKS.indexOf(userRank);
            const availableFolders = folderMap.filter(folder =>
                folder.ranks.some(rank => RANKS.indexOf(rank) <= userRankIndex)
            ).sort((a, b) => b.priority - a.priority); %>

            <div class="folder-grid folder-opened">
                <% availableFolders.forEach(folder => { %>
                    <div class="folder bg-white rounded-lg p-4 shadow flex justify-between items-center cursor-pointer" onclick="toggleFolder('<%= folder.name %>')">
                        <div>
                            <i class="fas <%= folder.icon %> text-2xl mb-2"></i>
                            <p class="font-semibold mt-2"><%= folder.name %></p>
                        </div>
                        <% const primaryRank = folder.ranks.find(r => RANKS.indexOf(r) <= userRankIndex && r !== 'Citizen' && r !== 'Airman Basic'); %>
                        <% if (primaryRank) { %>
                            <img src="/images/<%= primaryRank.replace(/ /g, '') %>.png" alt="<%= primaryRank %>" class="h-10 w-auto">
                        <% } %>
                    </div>
                <% }) %>
            </div>

            <% availableFolders.forEach(folder => { %>
                <div id="folder-<%= folder.name %>" class="folder-content hidden">
                    <h2 class="text-xl font-bold mb-4"><%= folder.name %> Forms</h2>
                    <p class="text-gray-700">Insert <%= folder.name %> form components here.</p>
                </div>
            <% }) %>
        </div>
    </div>
</body>
</html>
